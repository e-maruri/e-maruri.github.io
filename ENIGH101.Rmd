---
title: "ENIGH 101"
output:
  html_document:
    toc: true
    toc_depth: 3
header:
  - \usepackage{amsmath}
  - \usepackage[spanish]{babel}
  - \selectlanguage{spanish}
---
\renewcommand{\tablename}{Tabla} 
---
```{r, echo=FALSE}
pacman::p_load(tidyverse, 
               stargazer,
               knitr,
               kableExtra,
               MASS,
               reldist)
options(knitr.table.format = "html")
rm(list = ls())
```

# ¿Qué es y para qué sirve? 

# ¿Cómo descargarla?

Actualmente la puedes descargar entrando al sitio del [INEGI](https://www.inegi.org.mx/), y siguiendo la ruta Datos > Programas > Encuestas en hogares > Regulares > ENIGH > Nueva serie > Microdatos > concentradohogar. Ahí también encontrarás los resultados simplificados que publica el INEGI, además de los cuestionarios que realizan hay un útil [manual](https://www.inegi.org.mx/contenidos/programas/enigh/nc/2018/doc/enigh18_descriptor_archivos_fd_ns.pdf) que explica cada una de las variables que aparecen en la ENIGH (que se recomienda tener a la mano). 

Aquí usaré la versión de 2018, la más reciente a la fecha, en formato csv, la cual he subido a mi sitio de github para mayor facilidad. 

```{r, cache=TRUE}
ENIGH <- read.csv("https://raw.githubusercontent.com/e-maruri/e-maruri.github.io/master/ENIGH_concentradohogar_2018.csv")

# Para quedaronos sólo con las que utilizaremos 
#ENIGH1 <- subset.data.frame(ENIGH, select = c("ï..folioviv", "foliohog", "ing_cor", "ingtrab", "trabajo", "negocio", "otros_trab", "rentas", "utilidad", "arrenda", "transfer", "jubilacion", "becas", "donativos", "remesas", "bene_gob", "transf_hog", "trans_inst", "estim_alqu", "otros_ing","factor","upm","est_dis"))
```

# Resultados básicos
Uno de los elementos más importantes de la ENIGH es el factor de espansión, llamado *factor* en la base de datos, pues cada observación representa a otras viviendas y personas de condiciones socioeconómicas similares, por lo que el factor de expansión constituye el peso que se le da a cada unidad muestral para  generalizar los resultados de la muestra a la población. 

Veamos un ejemplo de su importancia. La siguiente tablita muestra que la suma de la columna factor representa el número total de hogares, que al multiplicar cada una por el número total de integrantes de cada hogar nos da la población total. Se observa que cuando no consideramos el factor de expansión el ingreso corriente promedio trimestral es de poco más de 46 mil pesos, pero cuando sí consideramos el factor es 49.6 mil pesos, que es justo el que reporta el INEGI (como puede verse [aquí](https://www.inegi.org.mx/contenidos/programas/enigh/nc/2018/doc/enigh2018_ns_presentacion_resultados.pdf))).

```{r}
a <- sum(ENIGH$factor)
b <- sum(ENIGH$factor*ENIGH$tot_integ)
c <- mean(ENIGH$ing_cor)
d <- weighted.mean(ENIGH$ing_cor, ENIGH$factor)
A <- matrix(c(a,b,c,d), nrow = 1)
kable(A, col.names = c("Hogares", "Habitantes", "Ingreso corriente s.f.", "Ingreso corriente c.f."), 
      caption = "Primer resumen ENIGH", format.args = list(big.mark = ","), label = "t1") %>%
  footnote(general_title = "Fuente: elaboracion propia con datos de la ENIGH, INEGI.", general = "")
```

## Deciles de ingreso 
Uno de los principales resultados de la ENIGH es que nos permite generar los llamados deciles de ingreso. 

```{r}
deciles <- seq(0.1, 1, 0.1)
#Deciles sin factor
deciles_ingreso <- quantile(ENIGH$ing_cor, deciles)

#Deciles con factor
#utilizamos la función "wtd.quantile" de la libreria "reldist"
deciles_ingreso2 <- wtd.quantile(ENIGH$ing_cor, deciles, weight = ENIGH$factor)

#Comparación 
#kable(list(deciles_ingreso, deciles_ingreso2))

#Deciles sin factor
ENIGH1 <- ENIGH %>% mutate(Decil = case_when(
  ing_cor <= deciles_ingreso[1] ~ "I", 
  ing_cor <= deciles_ingreso[2] ~ "II",
  ing_cor <= deciles_ingreso[3] ~ "III",
  ing_cor <= deciles_ingreso[4] ~ "IV",
  ing_cor <= deciles_ingreso[5] ~ "V",
  ing_cor <= deciles_ingreso[6] ~ "VI",
  ing_cor <= deciles_ingreso[7] ~ "VII",
  ing_cor <= deciles_ingreso[8] ~ "VIII",
  ing_cor <= deciles_ingreso[9] ~ "IX",
  TRUE ~ "X"
)
)
B <- ENIGH1 %>% group_by(Decil) %>% summarize(weighted.mean(ing_cor, factor)) 
colnames(B) <- c("Decil", "Ing_prom")
B <- as.data.frame(B)

#Deciles con factor
ENIGH2 <- ENIGH %>% mutate(Decil = case_when(
  ing_cor <= deciles_ingreso2[1] ~ "I", 
  ing_cor <= deciles_ingreso2[2] ~ "II",
  ing_cor <= deciles_ingreso2[3] ~ "III",
  ing_cor <= deciles_ingreso2[4] ~ "IV",
  ing_cor <= deciles_ingreso2[5] ~ "V",
  ing_cor <= deciles_ingreso2[6] ~ "VI",
  ing_cor <= deciles_ingreso2[7] ~ "VII",
  ing_cor <= deciles_ingreso2[8] ~ "VIII",
  ing_cor <= deciles_ingreso2[9] ~ "IX",
  TRUE ~ "X"
)
)

C <- ENIGH2 %>% group_by(Decil) %>% summarize(weighted.mean(ing_cor, factor)) 
colnames(C) <- c("Decil", "Ing_prom")
C <- as.data.frame(C)

D <- cbind(arrange(B, Ing_prom),arrange(C,Ing_prom)[,2])

kable(D, col.names = c("Decil", "Ingreso promedio s.f.", "Ingreso promedio c.f."), 
      caption = "Deciles de ingreso", format.args = list(big.mark = ","), digits = 0) %>%
  footnote(general_title = "Fuente: elaboracion propia con datos de la ENIGH, INEGI.", general = "")
```

## Percentiles de ingreso 
Ahora lo mismo pero con percentiles, es decir, cada 1%. 

```{r}
percentiles <- seq(0.01, 1, 0.01)
# Percentiles con factor
percentiles_ingreso <- wtd.quantile(ENIGH$ing_cor, percentiles, weight = ENIGH$factor)

ENIGH3 <- subset.data.frame(ENIGH, select = c("factor", "ing_cor"))
ENIGH3 <- ENIGH3 %>% mutate(Percentil = "")

# Percentiles con factor

```
